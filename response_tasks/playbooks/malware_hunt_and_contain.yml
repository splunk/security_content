name: Malware Hunt and Contain
id: 1d7b437a-5114-4b94-a585-04c3362ba08f
tags:
  nist:
    RS.RP
description: Uses any presented filehash artifact sent to phantom and conducts a reputation check, hunts for additional systems, blocks file hash with <=10 positive detections and creates a ticket for follow up.  Any hashes found with >10 positive hits, automatically blockes the hashes, disables user accounts, logs off the user, shuts down the system and finally creates a urgent ticket.
author: Patrick Bareiss, Splunk
automation:
  role:
  sla_type: minutes
  sla:
  is_note_required: false
  actions:
    - file reputation
    - hunt file
    - get file
    - block hash
    - disable user
    - logoff user
    - shutdown system
    - create ticket
  playbooks:
    - scm: community
      playook: malware_hunt_and_contain
references:
  - https://github.com/phantomcyber/playbooks/blob/4.9/malware_hunt_and_contain.json
  - https://github.com/phantomcyber/playbooks/blob/4.9/malware_hunt_and_contain.py
  - https://github.com/phantomcyber/playbooks/blob/4.9/malware_hunt_and_contain.png
workflow: |
  1. Gets file reputation for every hash presented and filters hashes with >10 OR <=10 and >5 for positive hits
  2. Get the files that match and hunt the file hashes and return the system(s)/user(s) that have these files present
  3. If >10 then block hash, disable users, logoff user, shutdown system and create a ticket
  4. IF <=10 but >5 block hash, and create a ticket
  Ticket template:
    Virus Detected on # devices
    Hashes submitted with detections: (list hashes)
    File was found on # of devices (list devices)
    This impacts at least # users: (list users)
    # of hashes were submitted for blocking: (list hashes)
    # of users were forced to logoff: (list users)
    # of user accounts were disabled: (list users)
    # of systems were shutdown: (list systems)
version: 2
date: '2020-08-05'
