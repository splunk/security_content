name: ConnectWise ScreenConnect Path Traversal
id: 56a3ac65-e747-41f7-b014-dff7423c1dda
version: 2
date: '2024-05-13'
author: Michael Haag, Splunk
data_source:
- Sysmon EventID 11
type: TTP
status: production
description: The following analytic detects attempts to exploit the ConnectWise ScreenConnect
  CVE-2024-1708 vulnerability, which allows path traversal attacks by manipulating
  file_path and file_name parameters in the URL. It leverages the Endpoint datamodel
  Filesystem node to identify suspicious file system events, specifically targeting
  paths and filenames associated with ScreenConnect. This activity is significant
  as it can lead to unauthorized access to sensitive files and directories, potentially
  resulting in data exfiltration or arbitrary code execution. If confirmed malicious,
  attackers could gain unauthorized access and control over the host system, posing
  a severe security risk.
search: '| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)
  as lastTime from datamodel=Endpoint.Filesystem where Filesystem.file_path IN ("*\\ScreenConnect\\App_Extensions\\*")
  Filesystem.file_name IN ("*.aspx","*.ashx") by Filesystem.file_create_time Filesystem.process_id
  Filesystem.process_guid Filesystem.file_name Filesystem.file_path Filesystem.dest
  | `drop_dm_object_name(Filesystem)` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`
  | `connectwise_screenconnect_path_traversal_filter`'
how_to_implement: This analytic utilizes the Endpoint datamodel Filesystem node to
  identify path traversal attempts against ScreenConnect. Note that using SACL auditing
  or other file system monitoring tools may also be used to detect path traversal
  attempts. Typically the data for this analytic will come from EDR or other properly
  CIM mapped data sources.
known_false_positives: False positives are not expected, as the detection is based
  on the presence of file system events that indicate path traversal attempts. The
  analytic may be modified to look for any file writes to this path as it is not common
  for files to write here.
references:
- https://www.huntress.com/blog/a-catastrophe-for-control-understanding-the-screenconnect-authentication-bypass
- https://www.huntress.com/blog/detection-guidance-for-connectwise-cwe-288-2
- https://www.connectwise.com/company/trust/security-bulletins/connectwise-screenconnect-23.9.8
tags:
  analytic_story:
  - ConnectWise ScreenConnect Vulnerabilities
  asset_type: Endpoint
  confidence: 100
  impact: 100
  message: A path traversal attack against ScreenConnect has been detected on $dest$.
  mitre_attack_id:
  - T1190
  observable:
  - name: dest
    type: Hostname
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - Filesystem.file_create_time
  - Filesystem.process_id
  - Filesystem.process_guid
  - Filesystem.file_name
  - Filesystem.file_path
  - Filesystem.dest
  risk_score: 100
  security_domain: endpoint
  cve:
  - CVE-2024-1708
  - CVE-2024-1709
tests:
- name: True Positive Test
  attack_data:
  - data: 
      https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1190/screenconnect/sysmon_app_extensions.log
    source: XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
    sourcetype: xmlwineventlog
