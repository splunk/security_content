name: Windows Snake Malware Service Create
id: 64eb091f-8cab-4b41-9b09-8fb4942377df
version: 1
date: '2023-05-11'
author: Michael Haag, Splunk
status: production
type: TTP
data_source:
- Windows System 7045
description: 'The following analytic identifies a new service WerFaultSvc being created with a binary path located in the windows winsxs path. Per the report, the Snake version primarily discussed in this advisory registers a service to maintain persistence on a system. Typically this service is named WerFaultSvc which we assess was used to blend in with the legitimate Windows service WerSvc. On boot, this service will execute Snakes WerFault.exe,
  which Snake developers chose to hide among the numerous valid Windows WerFault.exe files in the windows WinSxS directory. Executing WerFault.exe will start the process of decrypting Snakes components and loading them into memory.'
search: '`wineventlog_system` EventCode=7045  ImagePath="*\\windows\\winSxS\\*" ImagePath="*\Werfault.exe"
  | stats count min(_time) as firstTime max(_time) as lastTime by Computer EventCode ImagePath ServiceName ServiceType | rename Computer as dest
  | `security_content_ctime(firstTime)`
  | `security_content_ctime(lastTime)` | `windows_snake_malware_service_create_filter`'
how_to_implement: To successfully implement this search, you need to be ingesting
  Windows System logs with the Service name, Service File Name Service Start type,
  and Service Type from your endpoints.
known_false_positives: False positives should be limited as this is a strict primary indicator used by Snake Malware.
references:
- https://media.defense.gov/2023/May/09/2003218554/-1/-1/0/JOINT_CSA_HUNTING_RU_INTEL_SNAKE_MALWARE_20230509.PDF
tags:
  analytic_story:
  - Snake Malware
  asset_type: Endpoint
  atomic_guid:
  - b8db787e-dbea-493c-96cb-9272296ddc49
  confidence: 90
  impact: 80
  message: A service, WerFaultSvc, was created on $dest$ and is related to Snake Malware.
  mitre_attack_id:
  - T1547.006
  - T1569.002
  observable:
  - name: dest
    type: Hostname
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 72
  required_fields:
  - EventCode
  - Service_File_Name
  - Service_Type
  - _time
  - Service_Name
  - Service_Start_Type
  - Service_Account
  - user
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/malware/snakemalware/snake-service-windows-system.log
    source: XmlWinEventLog:System
    sourcetype: XmlWinEventLog

