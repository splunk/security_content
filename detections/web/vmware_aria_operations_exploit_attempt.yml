name: VMWare Aria Operations Exploit Attempt
id: d5d865e4-03e6-43da-98f4-28a4f42d4df7
version: 1
date: '2023-06-21'
author: Michael Haag, Splunk
status: production
type: TTP
data_source: 
- Palo Alto Network Threat
description: The following analytic is designed to detect potential exploitation attempts against VMWare vRealize Network Insight that align with the characteristics of CVE-2023-20887. This specific vulnerability is a critical security flaw that, if exploited, could allow an attacker to execute arbitrary code on the affected system.

  The analytic operates by monitoring web traffic, specifically HTTP POST requests, directed towards a specific URL endpoint ("/saas./resttosaasservlet"). This endpoint is known to be vulnerable and is a common target for attackers exploiting this vulnerability.

  The behavior this analytic detects is the sending of HTTP POST requests to the vulnerable endpoint. This is a significant indicator of an attempted exploit as it is the primary method used to trigger the vulnerability. The analytic detects this behavior by analyzing web traffic data and identifying HTTP POST requests directed at the vulnerable endpoint.

  Identifying this behavior is crucial for a Security Operations Center (SOC) as it can indicate an active attempt to exploit a known vulnerability within the network. If the identified behavior is a true positive, it suggests an attacker is attempting to exploit the CVE-2023-20887 vulnerability in VMWare vRealize Network Insight. The impact of such an attack could be severe, potentially allowing the attacker to execute arbitrary code on the affected system, leading to unauthorized access, data theft, or further propagation within the network.
search: '| tstats count min(_time) as firstTime max(_time)
  as lastTime from datamodel=Web where Web.url IN ("*/saas./resttosaasservlet*")  Web.http_method=POST Web.status IN ("unknown", "200")
  by Web.http_user_agent, Web.status Web.http_method, Web.url, Web.url_length, Web.src, Web.dest, sourcetype
  | `drop_dm_object_name("Web")`
  | `security_content_ctime(firstTime)` 
  | `security_content_ctime(lastTime)` | `vmware_aria_operations_exploit_attempt_filter`'
how_to_implement: To successfully implement this search, you need to be ingesting
  web or proxy logs, or ensure it is being filled by a proxy like device, into the
  Web Datamodel. Restrict to specific dest assets to reduce false positives.
known_false_positives: False positives will be present based on gateways in use, modify the status field as needed.
references:
- https://nvd.nist.gov/vuln/detail/CVE-2023-20887
- https://viz.greynoise.io/tag/vmware-aria-operations-for-networks-rce-attempt?days=30
- https://github.com/sinsinology/CVE-2023-20887
- https://summoning.team/blog/vmware-vrealize-network-insight-rce-cve-2023-20887/
tags:
  CVE:
  - CVE-2023-20887
  analytic_story:
  - VMware Aria Operations vRealize CVE-2023-20887
  asset_type: Web Server
  atomic_guid: []
  confidence: 80
  impact: 90
  message: An exploitation attempt has occurred against $dest$ from $src$ related to CVE-2023-20887
  mitre_attack_id:
  - T1133
  - T1190
  - T1210
  - T1068
  observable:
  - name: dest
    type: Hostname
    role:
    - Victim
  - name: src
    type: IP Address
    role:
    - Attacker
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 72
  required_fields:
  - Web.http_method
  - Web.url
  - Web.url_length
  - Web.src
  - Web.dest
  - Web.http_user_agent
  security_domain: network
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1190/vmware/vmware_aria.log
    source: pan:threat
    sourcetype: pan:threat
