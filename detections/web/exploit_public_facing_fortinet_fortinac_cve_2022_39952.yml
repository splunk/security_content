name: Exploit Public-Facing Fortinet FortiNAC CVE-2022-39952
id: 2038f5c6-5aba-4221-8ae2-ca76e2ca8b97
version: 1
date: '2023-02-21'
author: Michael Haag, Splunk
type: TTP
datamodel:
- Web
description: The following analytic identifies a recent CVE-2022-39952 released publicly where the URI configWizard/keyUpload.jsp recieves a POST with the payload.zip, from there the POC script will schedule a cron to run the payload and contact the remote C2. 
search: '| tstats count min(_time) as firstTime max(_time)
  as lastTime from datamodel=Web where Web.url IN ("*configWizard/keyUpload.jsp*")  
  by Web.http_user_agent, Web.status Web.http_method, Web.url, Web.url_length, Web.src, Web.dest, sourcetype
  | `drop_dm_object_name("Web")`
  | `security_content_ctime(firstTime)` 
  | `security_content_ctime(lastTime)` 
  | `exploit_public_facing_fortinet_fortinac_cve_2022_39952_filter`'
how_to_implement: This detection requires the Web datamodel to be populated from a
  supported Technology Add-On like Splunk for Apache, Splunk for Nginx, or Splunk for Palo Alto.
known_false_positives: False positives may be present. Modify the query as needed to POST, or add additional filtering (based on log source).
references:
  - https://github.com/horizon3ai/CVE-2022-39952
  - https://www.horizon3.ai/fortinet-fortinac-cve-2022-39952-deep-dive-and-iocs/
  - https://viz.greynoise.io/tag/fortinac-rce-attempt?days=30
tags:
  analytic_story:
  - Fortinet FortiNAC CVE-2022-39952
  asset_type: Network
  cve:
  - CVE-2022-39952
  cis20:
  - CIS 3
  - CIS 5
  - CIS 16
  confidence: 80
  context:
  - Update context
  dataset:
  - https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1190/fortigate/web_fortinetnac.log
  impact: 80
  kill_chain_phases:
  - Exploitation
  - Installation
  message: Potential CVE-2022-39952 against a Fortinet NAC may be occurring against $dest$.
  mitre_attack_id:
  - T1190
  nist:
  - DE.CM
  observable:
  - name: dest
    type: Hostname
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - Web.http_user_agent
  - Web.http_method
  - Web.url
  - Web.url_length 
  - Web.src
  - Web.dest 
  - sourcetype
  risk_score: 64
  security_domain: network
