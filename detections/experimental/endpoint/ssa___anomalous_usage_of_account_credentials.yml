name: Anomalous Usage of Account Credentials
id: 629cbf9e-5785-11ec-9611-acde48001122
version: 1
date: '2021-12-07'
author: Lou Stella, Splunk
type: Anomaly
datamodel:
- Authentication
description: This is an anomaly generating detection looking for multiple interactive logins within a specific time period. 
search: '| from read_ssa_enriched_events() | eval device=ucast(map_get(input_event, "dest_device_id"), "string", null), auth_type=ucast(map_get(input_event, "authentication_type"), "integer", null), timestamp=parse_long(ucast(map_get(input_event, "_time"), "string", null)), src_user=ucast(map_get(input_event, "src_user/WINDOWS_ACCOUNT_NAME"), "string", null), reason=ucast(map_get(input_event, "reason"), "string", null) | where auth_type=2 OR auth_type=11 | where reason = "success"| stats estdc(src_user) AS user_counter by device, span(timestamp, 1200s, 300s) | where user_counter>=2  | rename window_end AS timestamp | eval start_time=window_start, end_time=timestamp, entities=mvappend(device), body=create_map(["user_counter", user_counter, "device", device]) | into write_ssa_detected_events();'
how_to_implement: To successfully implement this detection, you need to be ingesting logon events from workstations.
known_false_positives: Shared workstations can cause false positives
references:
-  https://attack.mitre.org/techniques/T1078/002/
tags:
  analytic_story:
  - Insider Threat
  kill_chain_phases:
  - Privilege Escalation
  - Lateral Movement
  mitre_attack_id:
  - T1078.002
  cis20:
  - CIS 14
  nist:
  - PR.AC
  - DE.AE
  product:
  - Splunk Behavioral Analytics
  required_fields:
  - _time
  security_domain: access
  impact: 20
  confidence: 30
  risk_score: 6
  context:
  - Source:Endpoint
  - Stage:Credential Access
  message: Multiple interactive logins detected on $device$
  risk_severity: low
  observable:
  - name: device
    type: Hostname
    role:
    - Victim
  
