name: PingID Multiple Failed MFA Requests For User
id: c1bc706a-0025-4814-ad30-288f38865036
version: 2
date: '2024-05-29'
author: Steven Dick
status: production
type: TTP
description: The following analytic identifies multiple failed multi-factor authentication
  (MFA) requests for a single user within a PingID environment. It triggers when 10
  or more MFA prompts fail within 10 minutes, using JSON logs from PingID. This activity
  is significant as it may indicate an adversary attempting to bypass MFA by bombarding
  the user with repeated authentication requests. If confirmed malicious, this could
  lead to unauthorized access, as the user might eventually accept the fraudulent
  request, compromising the security of the account and potentially the entire network.
data_source:
- PingID
search: >-
  `pingid` "result.status" IN ("FAILURE,authFail","UNSUCCESSFUL_ATTEMPT") | eval time
  = _time, src = coalesce('resources{}.ipaddress','resources{}.devicemodel'), user
  = upper('actors{}.name'), object = 'resources{}.devicemodel', reason = 'result.message'|
  bucket span=10m _time | stats dc(_raw) AS mfa_prompts min(time) as firstTime, max(time)
  as lastTime values(src) as src by user, reason, _time | `security_content_ctime(firstTime)`|
  `security_content_ctime(lastTime)` | where mfa_prompts >= 10 | `pingid_multiple_failed_mfa_requests_for_user_filter`
how_to_implement: Target environment must ingest JSON logging from a PingID(PingOne)
  enterprise environment, either via Webhook or Push Subscription.
known_false_positives: False positives may be generated by normal provisioning workflows
  for user device registration.
references:
- https://therecord.media/russian-hackers-bypass-2fa-by-annoying-victims-with-repeated-push-notifications/
- https://attack.mitre.org/techniques/T1621/
- https://attack.mitre.org/techniques/T1110/
- https://attack.mitre.org/techniques/T1078/004/
- https://docs.pingidentity.com/r/en-us/pingoneforenterprise/p14e_subscriptions?tocId=3xhnxjX3VzKNs3SXigWnQA
tags:
  analytic_story:
  - Compromised User Account
  asset_type: Identity
  confidence: 50
  impact: 100
  message: Multiple Failed MFA requests $mfa_prompts$ for user $user$ between $firstTime$
    and $lastTime$.
  mitre_attack_id:
  - T1621
  - T1078
  - T1110
  observable:
  - name: user
    type: User
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - resources{}.ipaddress
  - actors{}.name
  - result.message
  - resources{}.devicemodel
  - result.status
  security_domain: access
tests:
- name: True Positive Test
  attack_data:
  - data: 
      https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1621/pingid/pingid.log
    source: PINGID
    sourcetype: _json
