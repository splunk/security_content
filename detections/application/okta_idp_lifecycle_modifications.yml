name: Okta IDP Lifecycle Modifications
id: e0be2c83-5526-4219-a14f-c3db2e763d15
version: 2
date: '2024-05-28'
author: Bhavin Patel, Splunk
data_source: 
- Okta
type: Anomaly
status: production
description: The following analytic identifies modifications to Okta Identity Provider
  (IDP) lifecycle events, including creation, activation, deactivation, and deletion
  of IDP configurations. It uses OktaIm2 logs ingested via the Splunk Add-on for Okta
  Identity Cloud. Monitoring these events is crucial for maintaining the integrity
  and security of authentication mechanisms. Unauthorized or anomalous changes could
  indicate potential security breaches or misconfigurations. If confirmed malicious,
  attackers could manipulate authentication processes, potentially gaining unauthorized
  access or disrupting identity management systems.
search: '`okta` eventType IN ("system.idp.lifecycle.activate","system.idp.lifecycle.create","system.idp.lifecycle.delete","system.idp.lifecycle.deactivate")
  |  stats count  min(_time) as firstTime max(_time) as lastTime values(target{}.id)
  as target_id values(target{}.type) as target_modified by src dest src_user_id user
  user_agent command description | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`
  | `okta_idp_lifecycle_modifications_filter`'
how_to_implement: The analytic leverages Okta OktaIm2 logs to be ingested using the
  Splunk Add-on for Okta Identity Cloud (https://splunkbase.splunk.com/app/6553).
known_false_positives: It's possible for legitimate administrative actions or automated
  processes to trigger this detection, especially if there are bulk modifications
  to Okta IDP lifecycle events. Review the context of the modification, such as the
  user making the change and the specific lifecycle event modified, to determine if
  it aligns with expected behavior.
references:
- https://www.obsidiansecurity.com/blog/behind-the-breach-cross-tenant-impersonation-in-okta/
- https://splunkbase.splunk.com/app/6553
tags:
  analytic_story:
  - Suspicious Okta Activity
  asset_type: Okta Tenant
  confidence: 90
  impact: 90
  message: A user [$user$] is attempting IDP lifecycle modification - [$description$]
    from IP Address - [$src$]"
  mitre_attack_id:
  - T1087.004
  observable:
  - name: user
    type: User
    role:
    - Victim
  - name: src
    type: IP Address
    role:
    - Attacker
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - eventType
  - target{}.id
  - target{}.type
  - src
  - dest
  - src_user_id
  - user
  - user_agent
  - command
  - description
  security_domain: identity
tests:
- name: True Positive Test
  attack_data:
  - data: 
      https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1556/okta_idp/okta.log
    source: Okta
    sourcetype: OktaIM2:log
