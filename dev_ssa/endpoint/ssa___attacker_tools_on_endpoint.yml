name: Attacker Tools On Endpoint
id: 241b1159-cf78-4201-8fad-1c21c3c96213
version: 1
date: '2024-03-19'
author: Patrick Bareiss, Splunk
status: validation
type: TTP
description: The following analytic detects the use of tools that are commonly exploited by cybercriminals since these tools are usually associated with malicious activities 
  such as unauthorized access, network scanning, or data exfiltration and pose a significant threat to an organization's security infrastructure. 
  It also provides enhanced visibility into potential security threats and helps to proactively detect and respond to mitigate the risks associated with cybercriminal 
  activities. This detection is made by examining the process activity on the host, specifically focusing on processes that are known to be associated with attacker 
  tool names. This detection is important because it acts as an early warning system for potential security incidents that allows you to respond to security 
  incidents promptly. False positives might occur due to legitimate administrative activities that can resemble malicious actions. 
  You must develop a comprehensive understanding of typical endpoint activities and behaviors within the organization to accurately interpret and 
  respond to the alerts generated by this analytic. This ensures a proper balance between precision and minimizing false positives.
data_source:
- Windows Security 4688
search: 
  selection:
    process.cmd_line|contains:
    - ADRecon
    - ADCollector
    - nmap
    - PingCastle
    - SharpHound
    - ACLight
    - ADACLScan
    - Liza
    - LAPSToolkit
    - Rubeus
    - PassTheCert
    - Responder
    - Inveigh
    - hydra 
    - mimikatz
    - SharpKatz
    - nanodump
    - PowerSploit
    - PowerSharpPack
    - PrivescCheck
    - Seatbelt
    - KrbRelayUp
    - SharpImpersonation
    - Tokenvator
    - bloodyAD
    - Nimcrypt
    - ProtectMyTooling
    - Invoke-Obfuscation
    - chameleon
    - Covenant
  condition: selection
how_to_implement: The detection is based on data that originates from Endpoint Detection
  and Response (EDR) agents. These agents are designed to provide security-related
  telemetry from the endpoints where the agent is installed. To implement this search,
  you must ingest logs that contain the process GUID, process name, and parent process.
  Additionally, you must ingest complete command-line executions. These logs must
  be processed using the appropriate Splunk Technology Add-ons that are specific to
  the EDR product. The logs must also be mapped to the `Processes` node of the `Endpoint`
  data model. Use the Splunk Common Information Model (CIM) to normalize the field
  names and speed up the data modeling process.
known_false_positives: Some administrator activity can be potentially triggered, please
  add those users to the filter macro.
references: 
- https://github.com/Jean-Francois-C/Windows-Penetration-Testing
tags:
  analytic_story:
  - Monitor for Unauthorized Software
  - XMRig
  - SamSam Ransomware
  - Unusual Processes
  - CISA AA22-264A
  asset_type: Endpoint
  confidence: 80
  impact: 80
  message: An attacker tool $process_name$,listed in attacker_tools.csv is executed
    on host $dest$ by User $user$. This process $process_name$ is known to do- $description$
  mitre_attack_id:
  - T1036.005
  - T1036
  - T1003
  - T1595
  observable: []
  product:
  - Splunk Behavioral Analytics
  required_fields: []
  risk_score: 64
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1595/attacker_scan_tools/windows-security.log
    source: XmlWinEventLog:Security
    sourcetype: XmlWinEventLog
